# Vercel Cron 任务配置指南

## 续期服务配置

### 1. 配置文件位置
在项目根目录创建 `vercel.json` 文件，配置如下：

```json
{
  "crons": [{
    "path": "/api/renew",
    "schedule": "0 0 * * *"
  }]
}
```

### 2. 配置说明
- `path`: 续期 API 的路径，对应 `app/api/renew/route.ts`
- `schedule`: 定时任务的时间表达式
  - `0 0 * * *` 表示每天 UTC 时间 00:00 执行
  - 可以根据需要调整执行频率

### 3. 注意事项
1. **环境变量**
   - 确保在 Vercel 项目中设置了必要的环境变量：
     - `WALRUS_SIGNER_PRIVATE_KEY`: 用于续期操作的私钥
     - 其他 Walrus 和数据库相关的环境变量

2. **执行时间**
   - Vercel Cron 任务使用 UTC 时间
   - 建议将执行时间设置在低峰期
   - 考虑时区差异，确保在合适的时间执行

3. **资源限制**
   - Vercel Cron 任务有执行时间限制
   - 如果续期操作耗时较长，建议：
     - 分批处理需要续期的图片
     - 优化续期逻辑，减少单次执行时间

4. **错误处理**
   - API 路由中已包含错误处理
   - 建议监控 Vercel 的日志，及时发现续期失败的情况
   - 可以设置告警机制，当续期失败时通知管理员

5. **测试**
   - 部署前在本地测试续期 API
   - 使用 Vercel 的预览环境测试 Cron 任务
   - 确保续期操作不会影响正常服务

### 4. 监控和维护
1. 定期检查 Vercel 的 Cron 任务执行日志
2. 监控续期成功率
3. 定期检查数据库中的图片到期时间
4. 准备手动续期方案，作为自动续期的备份

### 5. 故障处理
如果续期服务出现问题：
1. 检查 Vercel 的 Cron 任务状态
2. 查看 API 执行日志
3. 验证环境变量是否正确
4. 检查数据库连接状态
5. 确认 Walrus 服务是否正常 